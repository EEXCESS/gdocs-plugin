<script type="text/javascript">
    var SearchResultList = function(tabContainer, resultContainer) {
        // init
        this._tabContainer = tabContainer;
        this._resultContainer = resultContainer;
        this._tabContainer.append($('<ul class="eexcess-tabs"><li class="active"><a href="#"><?!= msg('SEARCH_RESULT_LIST_ALL') ?></a></li><li><a href="#"><?!= msg('SEARCH_RESULT_LIST_IMAGES') ?></a></li><li><a href="#"><?!= msg('SEARCH_RESULT_LIST_CULTURAL') ?></a></li><li><a href="#"><?!= msg('SEARCH_RESULT_LIST_SCHOLARLY') ?></a></li></ul>'));
        $('.eexcess_tabs li').on('click', function() {
            if ($(this).hasClass('active')) return; // only refresh if tab changed

            $('.eexcess_tabs li.active').removeClass('active');
            $(this).addClass('active');
            switch ($(this).children('a').text()) {
                case '<?!= msg('SEARCH_RESULT_LIST_IMAGES') ?>':
                    break;
                case '<?!= msg('SEARCH_RESULT_LIST_CULTURAL') ?>':
                    break;
                case '<?!= msg('SEARCH_RESULT_LIST_SCHOLARLY') ?>':
                    break;
                default: // All
            }
        });

        this._msgContainer = $('<div id="message-container" style="display:none"></div>');
        this._loader = $('<img id="ajax-loader" style="display:none" src="http://mics.fim.uni-passau.de/wp-content/uploads/2014/10/ajax-loader.gif" alt="<?!= msg('SEARCH_RESULT_LIST_LOADING') ?>" />');
        this._error = $('<span class="error" style="display:none"></span>');
        this._info = $('<span style="display:none"></span>');

        this._list = $('<ul id="result-list"></ul>');

        // init
        this._msgContainer.append(this._loader);
        this._msgContainer.append(this._error);
        this._msgContainer.append(this._info);
        this._resultContainer.append(this._msgContainer);

        this._resultContainer.append(this._list);
    };

    SearchResultList.prototype.showResults = function(data) {
        this._empty();
        this._list.show();

        try{
            data = JSON.parse(data);
        }catch(e){
            data = null;
        }

        if (data === null || data.totalResults === 0 || data.totalResults === '0') {
            this.showInfo('<?!= msg('SEARCH_RESULT_LIST_EMPTY') ?>');
            return;
        }

        // show results
        var items = data.result;
        for (var i = 0, len = items.length; i < len; i++) {
            var item = items[i];
            var li = $('<li></li>');

            var link = $('<a href="' + item.uri +  '" target="_blank"></a>');
            var description = item.description;
            if (typeof description !== 'undefined' && description !== '') {
                $(link).attr('title', description);
            }
            li.append(link);

            var itemContainer = $('<div class="result-item"></div>');
            link.append(itemContainer);
            var contentDiv = $('<div class="result-content"></div>');
            itemContainer.append(contentDiv);

            // image
            var previewImage = item.previewImage;
            if (typeof previewImage !== 'undefined' || previewImage !== '') {
                previewImage = "https://raw.githubusercontent.com/EEXCESS/visualization-widgets/master/SearchResultList/media/no-img.png"; // TODO change image location
            }
            var img = $('<img align="left" class="result-image" src="' + previewImage + '" />');
            contentDiv.append(img);

            // title
            var title = item.title;
            if (typeof title === 'undefined') {
                title = '<?!= msg('SEARCH_RESULT_LIST_NO_TITLE') ?>';
            }
            contentDiv.append($('<span class="result-title">' + title + '</span>'));



            // provider
            var provider = item.facets.provider;
            if (typeof provider !== 'undefined') {// TODO change image location
                itemContainer.append($('<img alt="' + provider + '" title="<?!= msg('SEARCH_RESULT_LIST_PROVIDER') ?>: ' + provider + '" src="https://raw.githubusercontent.com/EEXCESS/visualization-widgets/master/SearchResultList/media/icons/' + provider + '-favicon.ico" class="partner-icon" />'));
            }

            this._list.append(li);
        }

        this._resultContainer.find('.result-image').error(function() {
            $(this).unbind("error").attr("https://raw.githubusercontent.com/EEXCESS/visualization-widgets/master/SearchResultList/media/no-img.png"); // TODO change image location
        });
    };

    SearchResultList.prototype.showAjaxLoader = function() {
        this._empty();
        this._loader.show();
        this._msgContainer.show();
    };

    SearchResultList.prototype._empty = function() {
        this._msgContainer.hide();
        this._loader.hide();
        this._error.hide();
        this._info.hide();

        this._list.hide();
        this._list.empty();
    };

    SearchResultList.prototype.showError = function(errorMsg) {
        this._empty();
        this._error.text(errorMsg);
        this._error.show();
        this._msgContainer.show();
    };

    SearchResultList.prototype.showInfo = function(infoMsg) {
        this._empty();
        this._info.text(infoMsg);
        this._info.show();
        this._msgContainer.show();
    };
</script>